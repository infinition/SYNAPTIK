<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYNAPTIC // ARM CONTROLLER</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <div id="app-container">
        <!-- HEADER -->
        <header class="glass-panel">
            <div class="logo">
                <h1>SYNAPTIC <span class="highlight">//</span> ARM CONTROLLER</h1>
            </div>
            <div class="header-status">
                <div id="time-display" style="font-family:var(--font-mono); color:#888; font-size:0.8rem;">00:00:00
                </div>
                <div class="status-pill disconnected" id="btn-arduino-status">
                    <div class="status-indicator"></div>
                    <span id="arduino-text">ARDUINO</span>
                </div>
                <div class="status-pill disconnected" id="btn-gamepad-status">
                    <div class="status-indicator"></div>
                    <span id="gamepad-text">NO GAMEPAD</span>
                </div>
                <button class="icon-btn" id="btn-theme" title="Theme">üé®</button>
                <button class="icon-btn" id="btn-settings" title="Settings">‚öôÔ∏è</button>
                <button class="icon-btn" id="btn-help" title="Shortcuts">?</button>
            </div>
        </header>

        <!-- MAIN LAYOUT -->
        <div class="main-layout">
            <!-- CENTER VISUALIZER -->
            <div id="visualizer-container" class="glass-panel">
                <div id="visualizer"></div>
                <div class="overlay-info">
                    NEURO-LINK VISUALIZER v2.0<br>
                    <span style="color:var(--primary-color)">ONLINE</span>
                </div>
                <div class="stats-panel" id="stats-panel" style="display:none;">
                    <div class="stats-row"><span>FPS:</span><span id="fps-counter">60</span></div>
                    <div class="stats-row"><span>TRI:</span><span id="tri-counter">0</span></div>
                    <div class="stats-row"><span>DRW:</span><span id="draw-counter">0</span></div>
                </div>
                <div class="viewer-controls">
                    <button class="icon-btn" id="btn-reset-camera" title="Reset Camera">üé•</button>
                    <button class="icon-btn" id="btn-bg-settings" title="Background">üåÑ</button>
                    <button class="icon-btn" id="btn-floor-settings" title="Floor">üìê</button>
                    <button class="icon-btn" id="btn-stats" title="Stats">üìä</button>
                    <button class="icon-btn" id="btn-performance" title="Performance Mode">‚ö°</button>
                </div>
            </div>
        </div>

        <!-- BOTTOM SEQUENCER -->
        <div class="bottom glass-panel">
            <div class="sequencer-header">
                <div style="display: flex; gap: 8px; align-items: center;">
                    <button class="icon-btn" id="btn-save-config" title="Save Config">üíæ</button>
                    <button class="icon-btn" id="btn-load-config" title="Load Config">üìÇ</button>
                    <h2 style="margin: 0;"><span class="highlight">///</span> TIMELINE SEQUENCER</h2>
                </div>
                <div class="sequencer-controls">
                    <button id="btn-record" class="btn danger">‚óè REC</button>
                    <button id="btn-play" class="btn success">‚ñ∂Ô∏è PLAY</button>
                    <button id="btn-stop" class="btn warning">‚èπ STOP</button>
                </div>
                <div class="sequencer-file-ops">
                    <button class="icon-btn" id="btn-add-servo" title="Add Servo">‚ûï</button>
                    <button class="icon-btn" id="btn-save-seq" title="Save Sequence">üíæ</button>
                    <button class="icon-btn" id="btn-load-seq" title="Load Sequence">üìÇ</button>
                    <button class="icon-btn" id="btn-clear-seq" title="Clear Timeline">üóëÔ∏è</button>
                </div>
            </div>
            <div id="timeline-wrapper" style="display: flex; height: calc(100% - 60px);">
                <div id="track-controls"
                    style="width: 280px; flex-shrink: 0; border-right: 1px solid #333; overflow-y: hidden;">
                    <!-- Generated by JS -->
                </div>
                <div id="timeline-container" style="flex-grow: 1; overflow: hidden;"></div>
            </div>
        </div>
    </div>

    <!-- MODALS -->
    <div class="modal-overlay" id="bg-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>BACKGROUND SETTINGS</h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="file-upload-area" id="bg-upload">
                <p>Drag & Drop Image or Click to Upload</p>
                <input type="file" id="bg-file-input" hidden accept="image/*">
            </div>
            <div class="modal-grid" id="bg-presets"></div>
        </div>
    </div>

    <div class="modal-overlay" id="floor-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>FLOOR SETTINGS</h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-grid" id="floor-presets"></div>
        </div>
    </div>

    <div class="modal-overlay" id="theme-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>THEME SELECTION</h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-grid" id="theme-presets"></div>
        </div>
    </div>

    <div class="modal-overlay" id="mesh-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>MESH CONFIGURATION: <span id="mesh-servo-name"></span></h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="file-upload-area" id="mesh-upload">
                <p>Upload Custom .OBJ Model</p>
                <input type="file" id="mesh-file-input" hidden accept=".obj">
            </div>
            <h4>Presets</h4>
            <div class="modal-grid" id="mesh-presets"></div>
            <h4 style="margin-top:20px">Color Override</h4>
            <div class="color-palette" id="color-palette"></div>
        </div>
    </div>

    <div class="modal-overlay" id="servo-settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SERVO SETTINGS: <span id="settings-servo-name"></span></h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="input-group">
                <label>Name</label>
                <input type="text" id="settings-servo-name-input">
            </div>
            <div class="input-group">
                <label>PIN</label>
                <input type="number" id="settings-servo-pin">
            </div>
            <div class="input-group">
                <label>Type</label>
                <select id="settings-servo-type">
                    <option value="base">Base</option>
                    <option value="joint">Joint</option>
                    <option value="wrist">Wrist</option>
                    <option value="claw">Claw</option>
                </select>
            </div>
            <div class="input-group">
                <label>Mode</label>
                <select id="settings-servo-mode">
                    <option value="positional">Positional (0‚Äì180¬∞)</option>
                    <option value="continuous">Continuous (‚àû / wheel)</option>
                </select>
            </div>
            <div class="input-group">
                <label>Start Angle</label>
                <input type="number" id="settings-servo-start">
            </div>
            <div class="input-group" style="display: flex; gap: 10px;">
                <div style="flex: 1;">
                    <label>Min</label>
                    <input type="number" id="settings-servo-min">
                </div>
                <div style="flex: 1;">
                    <label>Max</label>
                    <input type="number" id="settings-servo-max">
                </div>
            </div>
            <div class="input-group" style="display:flex; justify-content:space-between; align-items:center;">
                <label>Invert Physical Servo (Arduino)</label>
                <div class="toggle-switch" id="toggle-invert-servo"></div>
            </div>
            <div class="input-group">
                <label>Mapping</label>
                <button id="settings-btn-map" class="btn secondary" style="width: 100%;">NO MAP</button>
            </div>
            <div class="input-group" id="group-control-style" style="display:none;">
                <label>Control Style</label>
                <select id="settings-control-style">
                    <option value="absolute">Absolute (Spring)</option>
                    <option value="incremental">Incremental (Throttle)</option>
                </select>
            </div>
            <div class="input-group" id="group-deadzone" style="display:none;">
                <label>Deadzone (0.0 - 1.0)</label>
                <input type="number" id="settings-deadzone" min="0" max="1" step="0.01" value="0.1">
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button id="settings-btn-save" class="btn primary">SAVE</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settings-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>SYSTEM SETTINGS</h3>
                <button class="modal-close">√ó</button>
            </div>

            <h4 style="color: var(--primary-color); margin-top: 0;">Export / Import</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px;">
                <button id="btn-export" class="btn primary">EXPORT...</button>
                <button id="btn-import" class="btn secondary">IMPORT...</button>
            </div>

            <h4 style="color: var(--primary-color);">Display Settings</h4>
            <div class="input-group">
                <label>Timeline Scale</label>
                <input type="range" id="timeline-scale" min="0.01" max="0.5" step="0.01" value="0.1">
            </div>
            <div class="input-group">
                <label>Camera FOV</label>
                <input type="range" id="camera-fov" min="30" max="120" value="75">
            </div>
            <div class="input-group" style="display:flex; justify-content:space-between; align-items:center;">
                <label>Enable Shadows (High Performance Cost)</label>
                <div class="toggle-switch" id="toggle-shadows"></div>
            </div>
            <div class="input-group" style="display:flex; justify-content:space-between; align-items:center;">
                <label>Anti-Aliasing (Requires Restart)</label>
                <div class="toggle-switch active" id="toggle-antialiasing"></div>
            </div>
            <div class="input-group" style="display:flex; justify-content:space-between; align-items:center;">
                <label>Auto-Save Configuration</label>
                <div class="toggle-switch active" id="toggle-autosave"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>EXPORT / IMPORT</h3>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-grid">
                <div class="modal-item" id="export-arduino">
                    <h4>ARDUINO CODE</h4>
                    <p>Generate .ino file</p>
                </div>
                <div class="modal-item" id="export-csv">
                    <h4>CSV DATA</h4>
                    <p>Export sequence as CSV</p>
                </div>
                <div class="modal-item" id="export-json">
                    <h4>FULL PROJECT</h4>
                    <p>Save everything as JSON</p>
                </div>
                <div class="modal-item" id="import-project">
                    <h4>IMPORT PROJECT</h4>
                    <p>Load JSON project file</p>
                    <input type="file" id="import-file-input" hidden accept=".json">
                </div>
            </div>
        </div>
    </div>

    <!-- NOTIFICATION -->
    <div id="notification" class="notification"></div>
    <div id="tooltip" class="tooltip"></div>

    <!-- SHORTCUTS -->
    <div class="shortcuts-panel" id="shortcuts-panel">
        <div class="shortcuts-grid">
            <div><span class="shortcut-key">SPACE</span> Play/Pause</div>
            <div><span class="shortcut-key">R</span> Record</div>
            <div><span class="shortcut-key">S</span> Stop</div>
            <div><span class="shortcut-key">CTRL+S</span> Save Sequence</div>
            <div><span class="shortcut-key">‚Üê/‚Üí</span> Seek Timeline</div>
            <div><span class="shortcut-key">?</span> Toggle Help</div>
            <div><span class="shortcut-key">ESC</span> Close Modals</div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script src="js/utils.js"></script>
    <script src="js/loaders.js"></script>
    <script src="js/serial.js"></script>
    <script src="js/arm.js"></script>
    <script src="js/sequencer.js"></script>
    <script src="js/gamepad.js"></script>
    <script src="js/visualizer.js"></script>
    <script src="js/timeline.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/main.js"></script>
</body>

</html>